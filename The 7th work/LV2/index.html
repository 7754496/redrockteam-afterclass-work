<!DOCTYPE html>
<html>
<head>
</head>
<body>
<style>
</style>
<h1>《记承天寺夜游》</h1>
<p></p>
<!--
<script>
/*setTimeout嵌套*/

const str=`元丰六年十月十二日夜，解衣欲睡，月色入户，欣然起行。念无与为乐者，遂至承天寺寻张怀民。怀民亦未寝，相与步于中庭。庭下如积水空明，水中藻、荇交横，盖竹柏影也。何夜无月？何处无竹柏？但少闲人如吾两人者耳。`;

const p=document.getElementsByTagName("p")[0];
let index=0;
let display="";
(function more(){
    if(index>(str.length-1)) return;
    display+=str[index];
    p.innerText=display;
    index++;
    setTimeout(more,100);    
})();
</script>
-->
<!--
<script>
/*Promise 链式调用*/

const str=`元丰六年十月十二日夜，解衣欲睡，月色入户，欣然起行。念无与为乐者，遂至承天寺寻张怀民。怀民亦未寝，相与步于中庭。庭下如积水空明，水中藻、荇交横，盖竹柏影也。何夜无月？何处无竹柏？但少闲人如吾两人者耳。`;

const p=document.getElementsByTagName("p")[0];
let index=0;
let display="";
function more(){
    if(index>(str.length-1)) return;
    display+=str[index];
    p.innerText=display;
    index++;
    return new Promise(function(resolve,reject){
        setTimeout(function(){
            Task.then(more);
            resolve();
        },100);
    });       
};

let Task=new Promise(function(resolve,reject){
    resolve();
});
Task.then(more);
</script>
-->

<script>
/*async function*/

const str=`元丰六年十月十二日夜，解衣欲睡，月色入户，欣然起行。念无与为乐者，遂至承天寺寻张怀民。怀民亦未寝，相与步于中庭。庭下如积水空明，水中藻、荇交横，盖竹柏影也。何夜无月？何处无竹柏？但少闲人如吾两人者耳。`;

const p=document.getElementsByTagName("p")[0];
let index=0;
let display="";
let pending=true;
function more(){
    if(index>(str.length-1)){
        pending=false;
        return;
    }
    display+=str[index];
    p.innerText=display;
    index++;
    return new Promise(function(resolve,reject){
        setTimeout(function(){
            resolve();
        },100);
    });       
};

(async function(){
    while(pending){
        await more();
    }
})();

</script>
</body>
</html>